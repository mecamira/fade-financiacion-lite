{% extends "base.html" %}

{% block title %}Editar Convocatorias - Dashboard de Financiación{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="text-primary text-center">Gestión Manual de Convocatorias</h1>
            <p class="text-center lead">Buscar, editar y eliminar convocatorias existentes</p>
        </div>
    </div>

    <!-- Barra de navegación -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="btn-group w-100" role="group">
                <a href="{{ url_for('gestionar_convocatorias') }}" class="btn btn-outline-primary">
                    <i class="fas fa-plus-circle me-2"></i>Añadir desde BDNS
                </a>
                <a href="{{ url_for('editar_convocatorias') }}" class="btn btn-primary">
                    <i class="fas fa-edit me-2"></i>Gestión Manual
                </a>
            </div>
        </div>
    </div>

    <!-- Filtros -->
    <div class="card mb-4">
        <div class="card-header bg-light">
            <h5 class="mb-0"><i class="fas fa-search me-2"></i>Buscar Convocatorias</h5>
        </div>
        <div class="card-body">
            <div class="row g-3">
                <div class="col-md-3">
                    <input type="text" class="form-control" id="search-input" placeholder="Nombre, BDNS...">
                </div>
                <div class="col-md-2">
                    <select class="form-select" id="filter-organismo">
                        <option value="">Todos organismos</option>
                        {% for organismo in filter_options.organismos %}
                            <option value="{{ organismo }}">{{ organismo }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-2">
                    <select class="form-select" id="filter-estado">
                        <option value="">Todos estados</option>
                        {% for estado in filter_options.estados %}
                            <option value="{{ estado }}">{{ estado }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-2">
                    <button class="btn btn-primary w-100" id="btn-buscar">
                        <i class="fas fa-search me-1"></i>Buscar
                    </button>
                </div>
                <div class="col-md-3">
                    <button class="btn btn-success w-100" id="btn-nuevo">
                        <i class="fas fa-plus me-1"></i>Nueva Convocatoria
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabla -->
    <div class="card">
        <div class="card-header bg-light">
            <h5 class="mb-0">Resultados <span id="total" class="badge bg-secondary">0</span></h5>
        </div>
        <div class="card-body">
            <div id="loading" class="text-center d-none py-4">
                <div class="spinner-border"></div>
            </div>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Organismo</th>
                            <th>Estado</th>
                            <th>BDNS</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tabla-body">
                        <tr><td colspan="5" class="text-center">Busca convocatorias para comenzar</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Modal Editar (versión simplificada) -->
<div class="modal fade" id="modalEditar" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 id="modalTitle">Editar</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" style="max-height:70vh;overflow-y:auto">
                <input type="hidden" id="edit-id">
                <div class="row g-3">
                    <div class="col-md-8">
                        <label>Nombre *</label>
                        <input type="text" class="form-control" id="edit-nombre" required>
                    </div>
                    <div class="col-md-4">
                        <label>BDNS</label>
                        <input type="text" class="form-control" id="edit-bdns">
                    </div>
                    <div class="col-md-6">
                        <label>Organismo *</label>
                        <input type="text" class="form-control" id="edit-organismo" required>
                    </div>
                    <div class="col-md-3">
                        <label>Tipo Ayuda *</label>
                        <input type="text" class="form-control" id="edit-tipo" required>
                    </div>
                    <div class="col-md-3">
                        <label>Ámbito</label>
                        <input type="text" class="form-control" id="edit-ambito">
                    </div>
                    <div class="col-md-4">
                        <label>Estado</label>
                        <select class="form-select" id="edit-estado">
                            <option>Abierta</option>
                            <option>Cerrada</option>
                            <option>Pendiente</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label>Fecha Apertura</label>
                        <input type="date" class="form-control" id="edit-fecha-apertura">
                    </div>
                    <div class="col-md-4">
                        <label>Fecha Cierre</label>
                        <input type="date" class="form-control" id="edit-fecha-cierre">
                    </div>
                    <div class="col-12">
                        <label>Resumen Breve</label>
                        <textarea class="form-control" id="edit-resumen" rows="2"></textarea>
                    </div>
                    <div class="col-12">
                        <label>Descripción</label>
                        <textarea class="form-control" id="edit-descripcion" rows="3"></textarea>
                    </div>
                    <div class="col-6">
                        <label>Beneficiarios (uno por línea)</label>
                        <textarea class="form-control" id="edit-beneficiarios" rows="3"></textarea>
                    </div>
                    <div class="col-6">
                        <label>Sectores (uno por línea)</label>
                        <textarea class="form-control" id="edit-sectores" rows="3"></textarea>
                    </div>
                    <div class="col-12">
                        <label>Tipo de Proyecto</label>
                        <input type="text" class="form-control" id="edit-tipo-proyecto" placeholder="Ej: Investigación, desarrollo, innovación...">
                    </div>
                    <div class="col-6">
                        <label>Requisitos (uno por línea)</label>
                        <textarea class="form-control" id="edit-requisitos" rows="3" placeholder="Añadir cada requisito en una línea nueva"></textarea>
                    </div>
                    <div class="col-6">
                        <label>Tags (uno por línea)</label>
                        <textarea class="form-control" id="edit-tags" rows="3" placeholder="Palabras clave relevantes, una por línea"></textarea>
                    </div>
                    <div class="col-12">
                        <hr class="my-3">
                        <h6 class="text-muted">Financiación</h6>
                    </div>
                    <div class="col-md-6">
                        <label>Intensidad de Financiación</label>
                        <input type="text" class="form-control" id="edit-intensidad" placeholder="Ej: 70%, Hasta 100%...">
                    </div>
                    <div class="col-md-6">
                        <label>Importe Máximo</label>
                        <input type="text" class="form-control" id="edit-importe-maximo" placeholder="Ej: 500000, No especificado...">
                    </div>
                    <div class="col-md-6">
                        <label>Presupuesto Mínimo del Proyecto</label>
                        <input type="text" class="form-control" id="edit-presupuesto-minimo" placeholder="Ej: 50000, nan...">
                    </div>
                    <div class="col-md-6">
                        <label>Presupuesto Máximo del Proyecto</label>
                        <input type="text" class="form-control" id="edit-presupuesto-maximo" placeholder="Ej: 1000000, nan...">
                    </div>
                    <div class="col-12">
                        <hr class="my-3">
                        <h6 class="text-muted">Enlaces</h6>
                    </div>
                    <div class="col-12">
                        <label>URL BDNS</label>
                        <input type="url" class="form-control" id="edit-url-bdns" placeholder="https://www.infosubvenciones.es/bdnstrans/...">
                    </div>
                    <div class="col-12">
                        <label>URL Convocatoria</label>
                        <input type="url" class="form-control" id="edit-url-convocatoria" placeholder="https://...">
                    </div>
                    <div class="col-12">
                        <label>URL Bases Reguladoras</label>
                        <input type="url" class="form-control" id="edit-url-bases" placeholder="https://...">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="btn-guardar">Guardar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Eliminar -->
<div class="modal fade" id="modalEliminar" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5>Confirmar Eliminación</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>¿Eliminar esta convocatoria?</p>
                <p class="fw-bold" id="del-nombre"></p>
                <input type="hidden" id="del-id">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-danger" id="btn-eliminar">Eliminar</button>
            </div>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/financiacion_editar.js') }}"></script>
{% endblock %}
